{
    auto_https off
}

:{$PORT:5173} {
    # WebSocket proxy for /ws path
    handle /ws {
        reverse_proxy {$SERVER_HOST:server}:{$SERVER_PORT:8080} {
            header_up Host {http.request.host}
            header_up Upgrade {http.request.header.upgrade}
            header_up Connection {http.request.header.connection}
        }
    }

    # API proxy for /api path
    handle_path /api* {
        reverse_proxy {$SERVER_HOST:server}:{$SERVER_PORT:8080}
    }

    # Swagger UI proxy
    handle /swagger* {
        reverse_proxy {$SERVER_HOST:server}:{$SERVER_PORT:8080}
    }

    # Static files
    handle {
        root * /srv
        encode gzip
        try_files {path} /index.html
        file_server
    }
}